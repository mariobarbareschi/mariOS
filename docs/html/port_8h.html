<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>mariOS: include/port.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">mariOS
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">mariOS Answers the Request for an Implementation of an OS</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">port.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;inttypes.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for port.h:</div>
<div class="dyncontent">
<div class="center"><img src="port_8h__incl.png" border="0" usemap="#include_2port_8h" alt=""/></div>
<map name="include_2port_8h" id="include_2port_8h">
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="port_8h__dep__incl.png" border="0" usemap="#include_2port_8hdep" alt=""/></div>
<map name="include_2port_8hdep" id="include_2port_8hdep">
<area shape="rect" id="node2" href="mari_o_s_8h.html" title="include/mariOS.h" alt="" coords="5,80,104,107"/>
<area shape="rect" id="node3" href="queue_8h.html" title="include/queue.h" alt="" coords="9,155,101,181"/>
</map>
</div>
</div>
<p><a href="port_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a84380d5a78e52a1ea7176177e2e62c70"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="port_8h.html#a84380d5a78e52a1ea7176177e2e62c70">loadFirstTask</a> ()</td></tr>
<tr class="separator:a84380d5a78e52a1ea7176177e2e62c70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf8e036d55ca81e8edaeb41e4a50976b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="port_8h.html#aaf8e036d55ca81e8edaeb41e4a50976b">SVC_Handler</a> ()</td></tr>
<tr class="separator:aaf8e036d55ca81e8edaeb41e4a50976b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0eea14388b14c9e1baa3b040df2e243f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="port_8h.html#a0eea14388b14c9e1baa3b040df2e243f">PendSV_Handler</a> () __attribute__((naked))</td></tr>
<tr class="separator:a0eea14388b14c9e1baa3b040df2e243f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58c8b2ad0ea491a6642e5e1cbd358c89"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="port_8h.html#a58c8b2ad0ea491a6642e5e1cbd358c89">yield</a> ()</td></tr>
<tr class="separator:a58c8b2ad0ea491a6642e5e1cbd358c89"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22857ed9823f022f5988f9afdbb8994e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="port_8h.html#a22857ed9823f022f5988f9afdbb8994e">enter_critical_section</a> ()</td></tr>
<tr class="separator:a22857ed9823f022f5988f9afdbb8994e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c958c081c18f69c4e77d463d88dfc0d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="port_8h.html#a7c958c081c18f69c4e77d463d88dfc0d">exit_critical_sction</a> ()</td></tr>
<tr class="separator:a7c958c081c18f69c4e77d463d88dfc0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a733949d55467f26805cac11130a0e667"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="port_8h.html#a733949d55467f26805cac11130a0e667">configureSystick</a> (uint32_t systick_ticks)</td></tr>
<tr class="separator:a733949d55467f26805cac11130a0e667"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a733949d55467f26805cac11130a0e667"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a733949d55467f26805cac11130a0e667">&#9670;&nbsp;</a></span>configureSystick()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int configureSystick </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>systick_ticks</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The configureSystick function hides the main mechanism on which an RTOS is based, that is periodic interrupts from a system timer. A proper clock period must be select to generate a good interrupt period. Too short period may lead to low efficiency due to the fact that the RTOS routines (and scheduler too) are uselessly executed. Vice versa, Too large period may give to the RTOS less control on system execution.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">systick_ticks</td><td>is the number of ticks between two interrupts </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a22857ed9823f022f5988f9afdbb8994e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a22857ed9823f022f5988f9afdbb8994e">&#9670;&nbsp;</a></span>enter_critical_section()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void enter_critical_section </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The function enter_critical_section must guarantee that no other task can access shared resources of the system before calling the exit_critical_sction. This property can be simply achieved by disabling the system interrupts. </p>

</div>
</div>
<a id="a7c958c081c18f69c4e77d463d88dfc0d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c958c081c18f69c4e77d463d88dfc0d">&#9670;&nbsp;</a></span>exit_critical_sction()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void exit_critical_sction </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The function exit_critical_sction guarantees that the current task can be preempt by the scheduler in favor of other tasks. This property can be simply achieved by enabling the system interrupts. </p>

</div>
</div>
<a id="a84380d5a78e52a1ea7176177e2e62c70"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a84380d5a78e52a1ea7176177e2e62c70">&#9670;&nbsp;</a></span>loadFirstTask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void loadFirstTask </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Once the system is configured and ready for executing the user application, we need to get back a pristine system state, especially regarding the privileged stack. Once everything is cleaned, the system must trigger the first context switch via software interrupt.</p>
<p>As for ARM Cortex M3 and M4, we perform the stack reset by retreiving the initial stack pointer value from the interrupt table vector, while the first context switch is due to the SVC call. Since no more than one supervisor call is provided, we assume to call the number 0. </p>

</div>
</div>
<a id="a0eea14388b14c9e1baa3b040df2e243f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0eea14388b14c9e1baa3b040df2e243f">&#9670;&nbsp;</a></span>PendSV_Handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void PendSV_Handler </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>mariOS achieve the context switch by triggering the PendSV interrupt. For ARM architectures, PendSV is an interrupt-driven request for system-level service mainly used to completes the context switch. The function body is well documented.</p>
<p>It exploits two handers, namely marios_curr_task and marios_next_task. Before calling the first instruction of the PendSV_Handler, the uC has already pushed 8 4-byte values onto the stack, including first 4 general registers, of the task marios_curr_task. Once the remaining register have been pushed onto the marios_curr_task stack, the execution context of marios_next_task is restored by replay same steps, but in opposite direction. First, the stack pointer of marios_next_task is loaded, then registers are restored, except for the first 4 which will be automatically restored at the exit. </p>

</div>
</div>
<a id="aaf8e036d55ca81e8edaeb41e4a50976b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf8e036d55ca81e8edaeb41e4a50976b">&#9670;&nbsp;</a></span>SVC_Handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void SVC_Handler </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This SVC handler do provide only one interrupt. It performs the first task loading onto the uC, sets the Base Priority Mask Register to the lowest value. These commands need to be executed by the supervisor call since they need the privilege mode. </p>

</div>
</div>
<a id="a58c8b2ad0ea491a6642e5e1cbd358c89"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58c8b2ad0ea491a6642e5e1cbd358c89">&#9670;&nbsp;</a></span>yield()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void yield </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Whenever the scheduler wants to remove the current task in favor of another task, it can explicitly call the yield function, which will trigger the PendSV_Handler and, hence, the context switch. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jul 10 2018 23:14:07 for mariOS by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
